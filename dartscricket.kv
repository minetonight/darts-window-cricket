#:kivy 2.2.1
#:import Spinner kivy.uix.spinner.Spinner

<SectorButton>:
    background_normal: ''
    color: (1, 1, 1, 1)  # White text
    font_size: '28sp'
    bold: True
    size_hint_y: None
    height: dp(50)
    canvas.before:
        Color:
            rgba: [0.2, 0.4, 0.6, 1] if self.sector_state == 'normal' else ([0.2, 0.5, 0.2, 1] if self.sector_state == 'player_scoring' else ([0.6, 0.4, 0.0, 1] if self.sector_state == 'opponent_scoring' else [0.3, 0.3, 0.3, 1]))
        Line:
            width: 2
            rectangle: self.x, self.y, self.width, self.height

<Label>:
    font_size: '24sp'
    color: (0.9, 0.9, 0.9, 1)  # Light gray text for dark theme
    text_size: self.size
    halign: 'center'
    valign: 'middle'

<SectorIndicator>:
    orientation: 'horizontal'
    size_hint_y: None
    height: dp(50)
    padding: ['5dp', '5dp']
    spacing: '5dp'

    AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'center'
        size_hint_x: 1

        BoxLayout:
            orientation: 'horizontal'
            size_hint_x: None
            width: dp(100)
            spacing: '5dp'

            Label:
                id: mark1
                size_hint_x: None
                width: dp(30)
                font_size: '24sp'
                bold: True
                text: '_'
                color: (0.4, 0.4, 0.4, 1)  # Darker gray for empty marks
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            Label:
                id: mark2
                size_hint_x: None
                width: dp(30)
                font_size: '24sp'
                bold: True
                text: '_'
                color: (0.4, 0.4, 0.4, 1)  # Darker gray for empty marks
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            Label:
                id: mark3
                size_hint_x: None
                width: dp(30)
                font_size: '24sp'
                bold: True
                text: '_'
                color: (0.4, 0.4, 0.4, 1)  # Darker gray for empty marks
                text_size: self.size
                halign: 'center'
                valign: 'middle'

<DataInputScreen>:
    canvas.before:
        Color:
            rgba: (0.12, 0.12, 0.12, 1)  # Dark background
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: '20dp'
        spacing: '15dp'

        Label:
            text: 'Darts Cricket Setup'
            font_size: '32sp'
            bold: True
            size_hint_y: 0.2

        BoxLayout:
            orientation: 'vertical'
            spacing: '15dp'
            size_hint_y: 0.6
            # Player 1 Name
            BoxLayout:
                size_hint_y: None
                height: dp(50)
                spacing: '10dp'
                
                TextInput:
                    text: 'Player 1 name'
                    id: player1_name
                    multiline: False
                    font_size: '20sp'
                    background_color: (0.12, 0.12, 0.12, 1)
                    foreground_color: (1, 1, 1, 1)

            # Player 2 Name
            BoxLayout:
                size_hint_y: None
                height: dp(50)
                spacing: '10dp'
                                
                TextInput:
                    text: 'Player 2 name'
                    id: player2_name
                    multiline: False
                    font_size: '20sp'
                    background_color: (0.12, 0.12, 0.12, 1)
                    foreground_color: (1, 1, 1, 1)

            # Switch Positions Button
            Button:
                text: 'Switch Positions'
                size_hint_y: None
                height: dp(40)
                background_normal: ''
                background_color: (0.3, 0.3, 0.3, 1)
                color: (0.9, 0.9, 0.9, 1)
                font_size: '18sp'
                bold: True
                on_release: root.switch_positions()

            # Highest Scoring Sector
            BoxLayout:
                size_hint_y: None
                height: dp(50)
                spacing: '10dp'
                
                Label:
                    text: 'Highest Sector:'
                    size_hint_x: 0.3
                    font_size: '20sp'
                
                Spinner:
                    id: highest_sector
                    text: '20'
                    values: [str(i) for i in range(20, 5, -1)]
                    size_hint_x: 0.35
                    font_size: '20sp'
                    on_text: root.update_lowest_sector()
                
                Label:
                    text: 'Lowest Sector:'
                    size_hint_x: 0.2
                    font_size: '20sp'
                
                Label:
                    id: lowest_sector
                    text: '15'
                    size_hint_x: 0.15
                    font_size: '20sp'

            # Bull Points
            BoxLayout:
                size_hint_y: None
                height: dp(50)
                spacing: '10dp'
                
                Label:
                    text: 'Bull Points:'
                    size_hint_x: 0.3
                    font_size: '20sp'
                
                BoxLayout:
                    size_hint_x: 0.7
                    spacing: '10dp'
                    
                    ToggleButton:
                        id: bull_highest_plus_5
                        text: highest_sector.text + ' + 5'
                        group: 'bull_points'
                        font_size: '20sp'
                        on_state: root.update_bull_points()
                        state: 'down'  # Default selected
                    
                    ToggleButton:
                        id: bull_25
                        text: '25 points'
                        group: 'bull_points'
                        font_size: '20sp'
                        on_state: root.update_bull_points()

        Button:
            text: 'Start Game'
            size_hint_y: 0.2
            background_normal: ''
            background_color: (0.3, 0.7, 0.3, 1)
            color: (1, 1, 1, 1)
            font_size: '24sp'
            bold: True
            on_release: root.start_game()

<GameScreen>:
    canvas.before:
        Color:
            rgba: (0.12, 0.12, 0.12, 1)  # Dark background
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: '10dp'
        spacing: '10dp'

        # Undo buttons section
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.1
            spacing: '10dp'

            Button:
                text: 'Undo Prev Throw'
                size_hint_x: 0.5
                background_normal: ''
                background_color: (0.3, 0.3, 0.3, 1)  # Dark gray to match theme
                color: (0.9, 0.3, 0.3, 1)  # Red-ish text
                font_size: '18sp'
                bold: True

            Button:
                text: 'Undo a Hit'
                size_hint_x: 0.5
                background_normal: ''
                background_color: (0.3, 0.3, 0.3, 1)  # Dark gray to match theme
                color: (0.9, 0.3, 0.3, 1)  # Red-ish text
                font_size: '18sp'
                bold: True

        # Players header section
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.15
            spacing: '10dp'

            # Player 1 section
            BoxLayout:
                id: player1_container
                orientation: 'vertical'
                size_hint_x: 0.5

                Label:
                    id: player1_name
                    text: 'Player 1'
                    font_size: '24sp'
                    bold: True
                    size_hint_y: 0.4

                BoxLayout:
                    orientation: 'horizontal'
                    size_hint_y: 0.4
                    
                    Label:
                        id: player1_score
                        text: '0'
                        font_size: '28sp'
                        bold: True
                        size_hint_x: 0.6

                    Label:
                        id: player1_diff
                        text: '(-0)'
                        font_size: '20sp'
                        bold: True
                        color: (0.5, 0.5, 0.5, 1)  # Gray color
                        size_hint_x: 0.4

                Label:
                    id: player1_mpr
                    text: 'MPR: 1.0'
                    font_size: '16sp'
                    bold: True
                    size_hint_y: 0.21

            # Player 2 section
            BoxLayout:
                id: player2_container
                orientation: 'vertical'
                size_hint_x: 0.5

                Label:
                    id: player2_name
                    text: 'Player 2'
                    font_size: '24sp'
                    bold: True
                    size_hint_y: 0.4

                BoxLayout:
                    orientation: 'horizontal'
                    size_hint_y: 0.4
                    
                    Label:
                        id: player2_score
                        text: '0'
                        font_size: '28sp'
                        bold: True
                        size_hint_x: 0.6

                    Label:
                        id: player2_diff
                        text: '(-0)'
                        font_size: '20sp'
                        bold: True
                        color: (0.5, 0.5, 0.5, 1)  # Gray color
                        size_hint_x: 0.4

                Label:
                    id: player2_mpr
                    text: 'MPR: 1.0'
                    font_size: '16sp'
                    bold: True
                    size_hint_y: 0.21

        # Game Grid
        GridLayout:
            id: game_grid
            cols: 3
            size_hint_y: 0.7
            spacing: '5dp'
            padding: '5dp'

            # Dynamic sector rows will be added here by Python code

            # Bull row (always present)
            SectorIndicator:
                id: p1_sector_bull
                sector: 'Bull'
            SectorButton:
                id: btn_sector_bull
                text: 'Bull'
                on_release: root.on_sector_press('Bull')
            SectorIndicator:
                id: p2_sector_bull
                sector: 'Bull'

        # Next Player Button
        Button:
            id: next_player_btn
            text: 'Next Player'
            size_hint_y: 0.15
            background_normal: ''
            background_color: (0.3, 0.7, 0.3, 1)
            color: (1, 1, 1, 1)
            font_size: '22sp'
            bold: True
            on_release: root.next_player() 